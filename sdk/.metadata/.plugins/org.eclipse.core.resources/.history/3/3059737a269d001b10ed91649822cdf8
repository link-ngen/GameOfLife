/*
 * gol_driver.c
 *
 *  Created on: 12.04.2021
 *      Author: progr
 */

#include "gol_driver.h"

static volatile uint32_t *pRegister;
static uint32_t length;

/**
 * Load pattern to the game of life grid.
 */
void init_gol(uint32_t base_addr, uint32_t data_array[])
{
	pRegister = (volatile uint32_t*) base_addr;

	// set default max iteration
	ioctrl_changeMaxIterationValue(DEFAULT_ITERATION);
//	length = 216;//sizeof(data_array) / sizeof(data_array[0]);
//
//	for (uint32_t idx = (length-1); idx >= 0; --idx)
//	{
//		write_bit_to_gol(data_array[idx]);
//	}
}

void ioctrl_changeMaxIterationValue(uint32_t value)
{
	pRegister[GOL_CTRL_REGISTER] |= GSI;
	pRegister[GOL_ITER_CTRL_REGISTER] = value;
}

void write_bit_to_gol(uint32_t data)
{
	pRegister[GOL_DATA_IN_REGISTER] = data & 0x01;
}

uint32_t read_bit_from_gol()
{
	write_bit_to_gol(0);
	return pRegister[GOL_DATA_OUT_REGISTER];
}

void read_gol(uint32_t data_array[])
{
	for (uint32_t idx = (length-1); idx >= 0; --idx)
	{
		data_array[idx] = read_bit_from_gol();
	}
}
